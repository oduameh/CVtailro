<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>CVtailro -- AI Resume Tailoring</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%231B2559' width='100' height='100' rx='20'/><text x='50' y='68' font-size='60' font-weight='bold' text-anchor='middle' fill='%2300B37E' font-family='system-ui'>CV</text></svg>">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');

        :root {
            --primary: #1B2559;
            --primary-light: #2D3A8C;
            --accent: #00B37E;
            --accent-hover: #00995A;
            --accent-light: #E6F9F1;
            --score-high: #00B37E;
            --score-mid: #F59E0B;
            --score-low: #EF4444;
            --bg: #F7F8FC;
            --card: #FFFFFF;
            --border: #E2E8F0;
            --text: #1A1D2E;
            --text-secondary: #6B7280;
            --error: #EF4444;
            --radius: 10px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            font-size: 15px;
            padding-left: env(safe-area-inset-left);
            padding-right: env(safe-area-inset-right);
            padding-bottom: env(safe-area-inset-bottom);
        }

        /* --- Sticky Header --- */
        .site-header {
            position: sticky;
            top: 0;
            z-index: 100;
            height: 64px;
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 24px;
        }

        .site-logo {
            font-size: 20px;
            font-weight: 800;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0;
        }

        .site-logo .cv { color: var(--accent); }
        .site-logo .tailro { color: var(--primary); }

        .header-cta {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 8px 18px;
            background: var(--accent);
            color: #fff;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            font-family: inherit;
            cursor: pointer;
            text-decoration: none;
            transition: background 0.2s;
        }

        .header-cta:hover { background: var(--accent-hover); }

        /* --- Hero Section --- */
        .hero {
            background: linear-gradient(135deg, #0F1629 0%, #1B2559 50%, #2D3A8C 100%);
            color: #fff;
            text-align: center;
            padding: 80px 24px 72px;
            position: relative;
            overflow: hidden;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 30%;
            left: 50%;
            width: 600px;
            height: 600px;
            background: radial-gradient(circle, rgba(0, 179, 126, 0.08) 0%, transparent 70%);
            transform: translate(-50%, -50%);
            pointer-events: none;
        }

        .hero-inner {
            position: relative;
            z-index: 1;
            max-width: 640px;
            margin: 0 auto;
        }

        .hero h1 {
            font-size: 44px;
            font-weight: 800;
            letter-spacing: -1.5px;
            line-height: 1.1;
            margin-bottom: 20px;
        }

        .hero-sub {
            font-size: 18px;
            color: rgba(255, 255, 255, 0.7);
            line-height: 1.6;
            font-weight: 400;
            max-width: 540px;
            margin: 0 auto;
        }

        /* --- Trust Bar --- */
        .trust-bar {
            background: var(--bg);
            border-top: 1px solid var(--border);
            border-bottom: 1px solid var(--border);
            text-align: center;
            padding: 14px 24px;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .trust-bar span {
            margin: 0 6px;
            color: #D1D5DB;
        }

        /* --- Container --- */
        .container {
            max-width: 920px;
            margin: 0 auto;
            padding: 32px 24px 60px;
        }

        /* --- Cards --- */
        .card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 28px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.04);
        }

        .card h2 {
            font-size: 15px;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 20px;
        }

        /* --- Form Layout: side by side --- */
        .form-columns {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 0;
        }

        .form-columns .card {
            margin-bottom: 0;
        }

        /* --- Upload Zone --- */
        .upload-zone {
            border: 2px dashed #CBD5E1;
            border-radius: var(--radius);
            padding: 48px 28px;
            text-align: center;
            cursor: pointer;
            transition: border-color 0.2s, background 0.2s;
            position: relative;
            background: #FAFBFE;
        }

        .upload-zone:hover {
            border-color: var(--accent);
            background: var(--accent-light);
        }

        .upload-zone.dragover {
            border-color: var(--accent);
            background: var(--accent-light);
        }

        .upload-zone.has-file {
            border-color: var(--accent);
            background: var(--accent-light);
        }

        .upload-zone input[type="file"] {
            position: absolute;
            inset: 0;
            opacity: 0;
            cursor: pointer;
        }

        .upload-icon {
            width: 48px;
            height: 48px;
            margin: 0 auto 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .upload-icon svg {
            width: 40px;
            height: 40px;
            color: var(--text-secondary);
        }

        .upload-zone.has-file .upload-icon svg {
            color: var(--accent);
        }

        .upload-label {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .upload-label strong {
            color: var(--accent);
            font-weight: 600;
        }

        .upload-privacy {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }

        .upload-privacy svg {
            width: 12px;
            height: 12px;
            flex-shrink: 0;
        }

        .file-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--accent);
            margin-top: 10px;
        }

        /* --- Textarea --- */
        textarea {
            width: 100%;
            min-height: 200px;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 14px;
            font-family: inherit;
            font-size: 14px;
            line-height: 1.6;
            resize: vertical;
            outline: none;
            transition: border-color 0.2s, box-shadow 0.2s;
            color: var(--text);
            background: #fff;
        }

        textarea:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(0, 179, 126, 0.1);
        }

        textarea::placeholder { color: #94A3B8; }

        textarea.input-error {
            border-color: var(--error);
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
        }

        .char-count {
            margin-top: 8px;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .inline-error {
            color: var(--error);
            font-size: 12px;
            font-weight: 500;
            margin-top: 6px;
            display: none;
        }

        .inline-error.visible { display: block; }

        /* --- Controls Row --- */
        .controls-row {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-top: 20px;
            margin-bottom: 0;
            flex-wrap: wrap;
        }

        .toggle-group {
            display: flex;
            border: 1px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
        }

        .toggle-group label {
            padding: 10px 18px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            user-select: none;
            white-space: nowrap;
            min-height: 44px;
            display: flex;
            align-items: center;
            color: var(--text-secondary);
            background: #fff;
        }

        .toggle-group input { display: none; }

        .toggle-group input:checked + label {
            background: var(--primary);
            color: #fff;
        }

        .toggle-group label:hover {
            background: #F1F5F9;
        }

        .toggle-group input:checked + label:hover {
            background: var(--primary-light);
        }

        /* --- CTA Row --- */
        .cta-row {
            margin-top: 20px;
            text-align: center;
        }

        .btn-run {
            width: 100%;
            max-width: 420px;
            padding: 14px 24px;
            background: var(--accent);
            color: #fff;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            font-family: inherit;
            cursor: pointer;
            transition: background 0.2s, box-shadow 0.2s;
            min-height: 44px;
        }

        .btn-run:hover:not(:disabled) {
            background: var(--accent-hover);
            box-shadow: 0 4px 16px rgba(0, 179, 126, 0.25);
        }

        .btn-run:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .cta-hint {
            font-size: 13px;
            color: var(--text-secondary);
            margin-top: 10px;
        }

        /* --- Error Banner --- */
        .error-banner {
            display: none;
            padding: 14px 18px;
            background: #FEE2E2;
            color: var(--error);
            border-radius: 8px;
            font-size: 14px;
            margin-bottom: 20px;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
        }

        .error-banner.active { display: flex; }

        .error-banner-msg { flex: 1; }

        .error-close {
            background: none;
            border: none;
            color: var(--error);
            font-size: 20px;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
            line-height: 1;
            font-weight: 700;
            flex-shrink: 0;
            transition: background 0.15s;
        }

        .error-close:hover {
            background: rgba(239, 68, 68, 0.1);
        }

        /* --- Progress Section --- */
        .progress-section { display: none; }
        .progress-section.active { display: block; }

        .progress-wrap {
            max-width: 520px;
            margin: 0 auto;
            text-align: center;
        }

        .progress-current-stage {
            font-size: 15px;
            font-weight: 500;
            color: var(--text);
            margin-bottom: 16px;
        }

        .progress-bar-track {
            width: 100%;
            height: 6px;
            background: #E2E8F0;
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .progress-bar-fill {
            width: 0%;
            height: 100%;
            background: var(--accent);
            border-radius: 3px;
            transition: width 1.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .progress-pct {
            font-size: 13px;
            font-weight: 600;
            color: var(--accent);
            margin-bottom: 16px;
        }

        .time-estimate {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        .tip-container {
            text-align: center;
            margin-bottom: 28px;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .tip-text {
            font-size: 13px;
            color: var(--text-secondary);
            font-style: italic;
            line-height: 1.5;
            transition: opacity 0.5s ease;
        }

        .stage-list {
            text-align: left;
            max-width: 400px;
            margin: 0 auto;
        }

        .stage {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 0;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .stage-check {
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            font-size: 12px;
        }

        .stage-check.pending {
            color: #D1D5DB;
        }

        .stage-check.running {
            color: var(--accent);
        }

        .stage-check.done {
            color: var(--accent);
        }

        .stage-check.error {
            color: var(--error);
        }

        .stage-name {
            font-weight: 500;
        }

        .stage.is-done .stage-name {
            color: var(--text-secondary);
        }

        .stage.is-running .stage-name {
            color: var(--text);
            font-weight: 600;
        }

        /* --- Results Section --- */
        .results-section { display: none; }
        .results-section.active { display: block; }

        /* --- Circular Score --- */
        .score-section {
            text-align: center;
            margin-bottom: 28px;
        }

        .score-ring-wrap {
            display: inline-block;
            position: relative;
            width: 140px;
            height: 140px;
            margin-bottom: 8px;
        }

        .score-ring-wrap svg {
            width: 140px;
            height: 140px;
            transform: rotate(-90deg);
        }

        .score-ring-bg {
            fill: none;
            stroke: #E2E8F0;
            stroke-width: 10;
        }

        .score-ring-fill {
            fill: none;
            stroke-width: 10;
            stroke-linecap: round;
            transition: stroke-dashoffset 1.5s cubic-bezier(0.4, 0, 0.2, 1), stroke 0.3s;
        }

        .score-ring-value {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 36px;
            font-weight: 800;
            color: var(--text);
        }

        .score-ring-label {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-secondary);
        }

        .score-stats {
            display: flex;
            justify-content: center;
            gap: 32px;
            margin-top: 16px;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .score-stats strong {
            color: var(--text);
            font-weight: 700;
        }

        /* --- Keywords --- */
        .keywords-section {
            margin-top: 20px;
        }

        .keywords-section-label {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .keywords {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .kw {
            font-size: 12px;
            padding: 4px 10px;
            border-radius: 4px;
            font-weight: 600;
        }

        .kw-matched {
            background: var(--accent-light);
            color: #047857;
            border: 1px solid #A7F3D0;
        }

        .kw-missing {
            background: #FEF2F2;
            color: #B91C1C;
            border: 1px solid #FECACA;
        }

        /* --- Downloads --- */
        .downloads-heading {
            font-size: 15px;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 20px;
        }

        .dl-cards {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 16px;
        }

        .dl-card {
            display: block;
            text-decoration: none;
            background: #FAFBFE;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 20px;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .dl-card:hover {
            border-color: var(--accent);
            box-shadow: 0 2px 8px rgba(0, 179, 126, 0.1);
        }

        .dl-card-icon {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 12px;
        }

        .dl-card-icon.ats {
            background: var(--accent-light);
            color: var(--accent);
        }

        .dl-card-icon.rec {
            background: #EDE9FE;
            color: #7C3AED;
        }

        .dl-card-icon svg {
            width: 20px;
            height: 20px;
        }

        .dl-card-title {
            font-size: 14px;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 4px;
        }

        .dl-card-desc {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 12px;
            line-height: 1.5;
        }

        .dl-card-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            background: var(--accent);
            color: #fff;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
        }

        .dl-card.rec-card .dl-card-btn {
            background: #7C3AED;
        }

        .dl-usage-hint {
            font-size: 12px;
            color: var(--text-secondary);
            line-height: 1.5;
            margin-bottom: 20px;
        }

        /* --- Additional Files (collapsible) --- */
        .additional-toggle {
            display: flex;
            align-items: center;
            gap: 6px;
            background: none;
            border: none;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 8px 0;
            font-family: inherit;
        }

        .additional-toggle:hover { color: var(--text); }

        .additional-toggle svg {
            width: 14px;
            height: 14px;
            transition: transform 0.2s;
        }

        .additional-toggle.open svg {
            transform: rotate(90deg);
        }

        .additional-files {
            display: none;
            padding-top: 8px;
        }

        .additional-files.open {
            display: block;
        }

        .additional-files-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .dl-btn-secondary {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 14px;
            background: #F1F5F9;
            color: var(--text);
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            text-decoration: none;
            transition: background 0.2s;
        }

        .dl-btn-secondary:hover {
            background: #E2E8F0;
        }

        .dl-btn-secondary .badge {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 2px 6px;
            border-radius: 3px;
            background: rgba(0, 0, 0, 0.06);
            color: var(--text-secondary);
        }

        /* --- Talking Points --- */
        .talking-points-card {
            background: #FAFBFE;
            border: 1px solid var(--border);
        }

        .talking-points-content {
            font-size: 14px;
            line-height: 1.7;
        }

        .talking-points-content h2 {
            font-size: 16px;
            font-weight: 700;
            margin: 16px 0 8px;
        }

        .talking-points-content h2:first-child { margin-top: 0; }
        .talking-points-content h3 { font-size: 14px; font-weight: 600; margin: 12px 0 6px; }
        .talking-points-content ul { padding-left: 20px; margin: 6px 0; }
        .talking-points-content li { margin-bottom: 4px; }
        .talking-points-content p { margin: 6px 0; }
        .talking-points-content strong { font-weight: 700; }

        /* --- Tabs / Preview --- */
        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .preview-header h2 { margin-bottom: 0; }

        .tabs {
            display: flex;
            border-bottom: 2px solid var(--border);
        }

        .tab {
            padding: 10px 18px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            margin-bottom: -2px;
            color: var(--text-secondary);
            transition: color 0.2s, border-color 0.2s;
            background: none;
            border-top: none;
            border-left: none;
            border-right: none;
            font-family: inherit;
        }

        .tab:hover { color: var(--text); }

        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab-content {
            display: none;
            max-height: 500px;
            overflow-y: auto;
            padding: 20px 24px;
            background: #fff;
            border-radius: 8px;
            font-size: 14px;
            line-height: 1.7;
        }

        .tab-content.active { display: block; }

        .tab-content h2 {
            font-size: 18px;
            font-weight: 700;
            margin: 20px 0 8px;
            color: var(--text);
        }

        .tab-content h2:first-child { margin-top: 0; }
        .tab-content h3 { font-size: 15px; font-weight: 600; margin: 16px 0 6px; color: var(--text); }
        .tab-content ul { padding-left: 20px; margin: 6px 0; }
        .tab-content li { margin-bottom: 4px; }
        .tab-content p { margin: 8px 0; }
        .tab-content strong { font-weight: 700; }

        .copy-btn {
            padding: 7px 14px;
            background: var(--primary);
            color: #fff;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
            font-family: inherit;
        }

        .copy-btn:hover { background: var(--primary-light); }

        /* --- Try Again --- */
        .again-wrap {
            text-align: center;
            margin-top: 32px;
        }

        .btn-again {
            padding: 12px 28px;
            background: var(--primary);
            color: #fff;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
            font-family: inherit;
        }

        .btn-again:hover { background: var(--primary-light); }

        /* --- Footer --- */
        .site-footer {
            background: linear-gradient(135deg, #0F1629, #1B2559);
            color: rgba(255, 255, 255, 0.7);
            text-align: center;
            padding: 40px 24px;
            font-size: 13px;
        }

        .footer-brand {
            font-size: 14px;
            color: #fff;
            margin-bottom: 12px;
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 12px;
        }

        .footer-links a {
            color: rgba(255, 255, 255, 0.5);
            text-decoration: none;
            font-size: 13px;
            transition: color 0.2s;
        }

        .footer-links a:hover { color: rgba(255, 255, 255, 0.8); }

        .footer-copy {
            color: rgba(255, 255, 255, 0.35);
            font-size: 12px;
        }

        /* --- Mobile --- */
        @media (max-width: 768px) {
            .site-header {
                padding: 0 16px;
            }

            .hero {
                padding: 56px 16px 48px;
            }

            .hero h1 {
                font-size: 32px;
                letter-spacing: -0.5px;
            }

            .hero-sub {
                font-size: 15px;
            }

            .container {
                padding: 20px 16px 40px;
            }

            .form-columns {
                grid-template-columns: 1fr;
            }

            .dl-cards {
                grid-template-columns: 1fr;
            }

            .controls-row {
                flex-direction: column;
                align-items: stretch;
            }

            .toggle-group {
                justify-content: center;
            }

            .toggle-group label {
                padding: 12px 18px;
                min-height: 44px;
                flex: 1;
                justify-content: center;
            }

            .btn-run {
                max-width: 100%;
            }

            textarea { min-height: 140px; }

            .score-stats {
                flex-direction: column;
                gap: 8px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="site-header">
        <a href="/" class="site-logo"><span class="cv">CV</span><span class="tailro">tailro</span></a>
        <a href="#formSection" class="header-cta">Try Free</a>
    </header>

    <!-- Hero -->
    <section class="hero">
        <div class="hero-inner">
            <h1>Tailor your resume to any job in minutes</h1>
            <p class="hero-sub">Upload your resume, paste the job description. Get an ATS-optimized version -- scored, rewritten, and ready to submit.</p>
        </div>
    </section>

    <!-- Trust Bar -->
    <div class="trust-bar">
        Free to use <span>&middot;</span> No sign-up required <span>&middot;</span> Your data stays private
    </div>

    <div class="container">
        <!-- Error Banner -->
        <div class="error-banner" id="errorBanner">
            <span class="error-banner-msg" id="errorMsg"></span>
            <button class="error-close" onclick="dismissError()" aria-label="Close">&times;</button>
        </div>

        <!-- Config Banner -->
        <div id="configBanner" style="display:none; padding: 14px 18px; background: #FEF3C7; color: #92400E;
             border: 1px solid #FCD34D; border-radius: 8px; font-size: 14px; margin-bottom: 20px;">
            Service is not configured. An admin needs to set the API key in the
            <a href="/admin" style="color: #92400E; font-weight: 600;">Admin Panel</a>.
        </div>

        <!-- Form Section -->
        <div id="formSection">
            <div class="form-columns">
                <!-- Upload Card -->
                <div class="card" id="uploadCard">
                    <h2>Upload Your Resume</h2>
                    <div class="upload-zone" id="uploadZone">
                        <input type="file" id="resumeFile" accept=".pdf,.md,.txt">
                        <div class="upload-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                <polyline points="14 2 14 8 20 8"/>
                                <line x1="12" y1="18" x2="12" y2="12"/>
                                <polyline points="9 15 12 12 15 15"/>
                            </svg>
                        </div>
                        <div class="upload-label" id="uploadLabel"><strong>Click to upload</strong> or drag and drop<br>PDF, Markdown, or plain text</div>
                        <div class="file-name" id="fileName" style="display:none"></div>
                    </div>
                    <div class="upload-privacy">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
                        Privacy guaranteed
                    </div>
                </div>

                <!-- Job Description Card -->
                <div class="card">
                    <h2>Paste the Job Description</h2>
                    <textarea id="jobDescription" placeholder="Paste the full job description here..."></textarea>
                    <div class="inline-error" id="jdError">Job description is too short. Please paste at least 50 characters.</div>
                    <div class="char-count"><span id="charCount">0</span> characters &middot; <span id="wordCount">0</span> words</div>
                </div>
            </div>

            <!-- Controls Row -->
            <div class="controls-row">
                <div class="toggle-group">
                    <input type="radio" name="mode" id="modeC" value="conservative" checked>
                    <label for="modeC">Conservative</label>
                    <input type="radio" name="mode" id="modeA" value="aggressive">
                    <label for="modeA">Aggressive</label>
                </div>
                <div class="toggle-group">
                    <input type="radio" name="template" id="tplExec" value="executive">
                    <label for="tplExec">Executive</label>
                    <input type="radio" name="template" id="tplModern" value="modern" checked>
                    <label for="tplModern">Modern</label>
                    <input type="radio" name="template" id="tplMin" value="minimal">
                    <label for="tplMin">Minimal</label>
                </div>
            </div>

            <!-- CTA -->
            <div class="cta-row">
                <button class="btn-run" id="btnRun" onclick="startTailoring()">Tailor My Resume</button>
                <div class="cta-hint">No sign-up required &middot; Takes about 2 minutes</div>
            </div>
        </div>

        <!-- Progress Section -->
        <div class="progress-section" id="progressSection">
            <div class="card">
                <div class="progress-wrap">
                    <div class="progress-current-stage" id="progressStageText">Analyzing your resume...</div>
                    <div class="progress-bar-track">
                        <div class="progress-bar-fill" id="progressFill"></div>
                    </div>
                    <div class="progress-pct" id="progressPct">0%</div>
                    <div class="time-estimate" id="timeEstimate">Usually takes 2-3 minutes</div>
                    <div class="tip-container" id="tipContainer">
                        <div class="tip-text" id="tipText">75% of resumes are rejected by ATS systems before a human sees them</div>
                    </div>
                    <div class="stage-list" id="stageList"></div>
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div class="results-section" id="resultsSection">
            <!-- Score -->
            <div class="card">
                <div class="score-section">
                    <div class="score-ring-wrap">
                        <svg viewBox="0 0 140 140">
                            <circle class="score-ring-bg" cx="70" cy="70" r="60"/>
                            <circle class="score-ring-fill" id="scoreRing" cx="70" cy="70" r="60" stroke-dasharray="376.99" stroke-dashoffset="376.99"/>
                        </svg>
                        <div class="score-ring-value" id="matchScore">--</div>
                    </div>
                    <div class="score-ring-label">Match Score</div>
                    <div class="score-stats">
                        <span>Keyword Match: <strong id="keywordMatch">--</strong></span>
                        <span><strong id="keywordsAdded">--</strong> keywords added</span>
                    </div>
                </div>
                <div class="keywords-section" id="kwSection" style="display:none">
                    <div class="keywords-section-label">Keywords</div>
                    <div class="keywords" id="kwList"></div>
                </div>
            </div>

            <!-- Downloads -->
            <div class="card">
                <div class="downloads-heading">Your Tailored Resumes</div>

                <div class="dl-cards" id="dlCards">
                    <div class="dl-card" id="dlCardAts">
                        <div class="dl-card-icon ats">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
                        </div>
                        <div class="dl-card-title">ATS Resume</div>
                        <div class="dl-card-desc">Optimized for automated screening systems</div>
                        <span class="dl-card-btn" id="dlBtnAts">Download PDF</span>
                    </div>
                    <div class="dl-card rec-card" id="dlCardRec">
                        <div class="dl-card-icon rec">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="8.5" cy="7" r="4"/><line x1="20" y1="8" x2="20" y2="14"/><line x1="23" y1="11" x2="17" y2="11"/></svg>
                        </div>
                        <div class="dl-card-title">Recruiter Resume</div>
                        <div class="dl-card-desc">Enhanced for human readability</div>
                        <span class="dl-card-btn" id="dlBtnRec">Download PDF</span>
                    </div>
                </div>

                <div class="dl-usage-hint">Use the ATS version for online applications. Use the Recruiter version when emailing directly.</div>

                <button class="additional-toggle" id="additionalToggle" onclick="toggleAdditional()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg>
                    Additional files
                </button>
                <div class="additional-files" id="additionalFiles">
                    <div class="additional-files-grid" id="dlGridSecondary"></div>
                </div>
            </div>

            <!-- Talking Points -->
            <div class="card talking-points-card" id="talkingPointsCard" style="display:none">
                <h2>Interview Talking Points</h2>
                <div class="talking-points-content" id="talkingPointsContent"></div>
            </div>

            <!-- Preview -->
            <div class="card">
                <div class="preview-header">
                    <h2 style="margin-bottom:0">Resume Preview</h2>
                    <button class="copy-btn" onclick="copyPreview()">Copy</button>
                </div>
                <div class="tabs" id="tabs"></div>
                <div id="panels"></div>
            </div>

            <div class="again-wrap">
                <button class="btn-again" onclick="resetForm()">Tailor Another Resume</button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="site-footer">
        <div class="footer-brand">CVtailro &middot; AI-powered resume optimization</div>
        <div class="footer-links">
            <a href="#">Privacy</a>
            <a href="#">Terms</a>
            <a href="#">Contact</a>
        </div>
        <div class="footer-copy">&copy; 2026 CVtailro. All rights reserved.</div>
    </footer>

    <script>
    // --- Stage Names: internal key -> user-friendly label ---
    var STAGES = [
        "Job Intelligence",
        "Resume Parser",
        "Gap Analysis",
        "Bullet Optimiser",
        "ATS Optimiser",
        "Recruiter Optimiser",
        "Final Assembly"
    ];
    var STAGE_LABELS = {
        "Job Intelligence": "Understanding the job requirements",
        "Resume Parser": "Analyzing your resume",
        "Gap Analysis": "Identifying skill gaps",
        "Bullet Optimiser": "Rewriting your bullet points",
        "ATS Optimiser": "Building your ATS-optimized resume",
        "Recruiter Optimiser": "Enhancing for recruiter appeal",
        "Final Assembly": "Generating interview prep & final documents"
    };

    // --- Tips rotation ---
    var TIPS = [
        "75% of resumes are rejected by ATS systems before a human sees them",
        "Tailoring your resume for each application can increase interview callbacks by 50%",
        "Our AI rewrites your bullet points using the exact language from the job description",
        "We generate both an ATS-optimized version and a recruiter-friendly version",
        "Your original resume content is never fabricated -- only reframed and enhanced",
        "We also prepare interview talking points based on your tailored resume"
    ];
    var tipIndex = 0;
    var tipInterval = null;

    function startTipRotation() {
        tipIndex = 0;
        var tipEl = document.getElementById('tipText');
        if (tipEl) tipEl.textContent = TIPS[0];
        tipInterval = setInterval(function() {
            tipIndex = (tipIndex + 1) % TIPS.length;
            var el = document.getElementById('tipText');
            if (el) {
                el.style.opacity = '0';
                setTimeout(function() {
                    el.textContent = TIPS[tipIndex];
                    el.style.opacity = '1';
                }, 400);
            }
        }, 8000);
    }

    function stopTipRotation() {
        if (tipInterval) { clearInterval(tipInterval); tipInterval = null; }
    }

    // --- Settings Management ---
    var serviceConfigured = false;
    var userSelectable = false;
    var selectedModel = '';

    async function loadSettings() {
        try {
            var statusResp = await fetch('/api/status');
            var statusData = await statusResp.json();
            serviceConfigured = statusData.configured;
            if (!serviceConfigured) {
                document.getElementById('configBanner').style.display = 'block';
                document.getElementById('btnRun').disabled = true;
            } else {
                document.getElementById('configBanner').style.display = 'none';
            }
        } catch(e) {
            document.getElementById('configBanner').style.display = 'block';
        }

        try {
            var modelsResp = await fetch('/api/models');
            var data = await modelsResp.json();
            userSelectable = data.user_selectable !== false;
            selectedModel = localStorage.getItem('cvtailro_model') || data.default || '';
            if (data.models && data.models.length > 0) {
                var validIds = data.models.map(function(m) { return m.id; });
                if (selectedModel && validIds.indexOf(selectedModel) === -1) {
                    selectedModel = data.default || '';
                }
            }
        } catch(e) {
            console.error('Failed to load models:', e);
        }
    }

    function saveModelPref() {
        localStorage.setItem('cvtailro_model', selectedModel);
    }

    function getSelectedModel() {
        if (!userSelectable) return '';
        return selectedModel;
    }

    loadSettings();

    var FILES = {
        "tailored_resume_ats.pdf":      {l:"ATS Resume",       b:"PDF",  cat:"ats",    primary:true},
        "tailored_resume_recruiter.pdf": {l:"Recruiter Resume", b:"PDF",  cat:"rec",    primary:true},
        "tailored_resume_ats.md":        {l:"ATS Resume",       b:"MD",   cat:"ats",    primary:false},
        "tailored_resume_recruiter.md":  {l:"Recruiter Resume", b:"MD",   cat:"rec",    primary:false},
        "match_report.json":             {l:"Match Report",     b:"JSON", cat:"other",  primary:false},
        "interview_talking_points.md":   {l:"Talking Points",   b:"MD",   cat:"other",  primary:false}
    };

    // --- Mobile detection for upload label ---
    function isTouchDevice() {
        return ('ontouchstart' in window) || (navigator.maxTouchPoints > 0);
    }
    (function setUploadLabel() {
        var label = document.getElementById('uploadLabel');
        if (isTouchDevice()) {
            label.innerHTML = '<strong>Tap to upload</strong><br>PDF, Markdown, or plain text';
        } else {
            label.innerHTML = '<strong>Click to upload</strong> or drag and drop<br>PDF, Markdown, or plain text';
        }
    })();

    // File upload
    var uploadZone = document.getElementById("uploadZone");
    var fileInput = document.getElementById("resumeFile");
    var fileNameEl = document.getElementById("fileName");
    fileInput.addEventListener("change", function() {
        if (fileInput.files.length > 0) {
            uploadZone.classList.add("has-file");
            fileNameEl.textContent = fileInput.files[0].name;
            fileNameEl.style.display = "block";
        }
    });
    uploadZone.addEventListener("dragover", function(e) { e.preventDefault(); uploadZone.classList.add("dragover"); });
    uploadZone.addEventListener("dragleave", function() { uploadZone.classList.remove("dragover"); });
    uploadZone.addEventListener("drop", function(e) {
        e.preventDefault();
        uploadZone.classList.remove("dragover");
        if (e.dataTransfer.files.length > 0) {
            fileInput.files = e.dataTransfer.files;
            fileInput.dispatchEvent(new Event("change"));
        }
    });

    // Char count
    var jdTA = document.getElementById("jobDescription");
    jdTA.addEventListener("input", function() {
        document.getElementById("charCount").textContent = jdTA.value.length;
        document.getElementById("wordCount").textContent = jdTA.value.split(/\s+/).filter(function(w) { return w; }).length;
        if (jdTA.value.trim().length >= 50) {
            jdTA.classList.remove('input-error');
            document.getElementById('jdError').classList.remove('visible');
        }
    });

    // Keyboard shortcut
    document.addEventListener("keydown", function(e) {
        if ((e.ctrlKey || e.metaKey) && e.key === "Enter" && !document.getElementById("btnRun").disabled) startTailoring();
    });

    function showError(msg) {
        var b = document.getElementById("errorBanner");
        document.getElementById("errorMsg").textContent = msg;
        b.classList.add("active");
    }

    function dismissError() {
        document.getElementById("errorBanner").classList.remove("active");
    }

    // --- Simple markdown to HTML renderer ---
    function renderMarkdown(text) {
        if (!text) return '';
        var html = escapeHtml(text);

        // Headings: ### then ##
        html = html.replace(/^### (.+)$/gm, '<h3>$1</h3>');
        html = html.replace(/^## (.+)$/gm, '<h2>$1</h2>');

        // Bold: **text**
        html = html.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');

        // Italic: *text*
        html = html.replace(/(?<!\*)\*(?!\*)(.+?)(?<!\*)\*(?!\*)/g, '<em>$1</em>');

        // Unordered list items: lines starting with - or *
        html = html.replace(/^[-*] (.+)$/gm, '<li>$1</li>');

        // Wrap consecutive <li> in <ul>
        html = html.replace(/((?:<li>.*<\/li>\n?)+)/g, '<ul>$1</ul>');

        // Paragraphs: wrap remaining non-tag text lines
        html = html.split('\n').map(function(line) {
            line = line.trim();
            if (!line) return '';
            if (line.startsWith('<h') || line.startsWith('<ul') || line.startsWith('<li') || line.startsWith('</')) return line;
            return '<p>' + line + '</p>';
        }).join('\n');

        // Clean up empty <p></p>
        html = html.replace(/<p>\s*<\/p>/g, '');

        return html;
    }

    function escapeHtml(t) {
        var d = document.createElement("div");
        d.textContent = t;
        return d.innerHTML;
    }

    function renderStages() {
        document.getElementById("stageList").innerHTML = STAGES.map(function(n, i) {
            var label = STAGE_LABELS[n] || n;
            return '<div class="stage" id="stage-row-' + (i+1) + '">' +
                '<div class="stage-check pending" id="ind-' + (i+1) + '">' +
                    '<svg width="18" height="18" viewBox="0 0 18 18" fill="none"><circle cx="9" cy="9" r="7" stroke="currentColor" stroke-width="1.5" fill="none"/></svg>' +
                '</div>' +
                '<div class="stage-name">' + label + '</div>' +
                '<div class="stage-detail" id="det-' + (i+1) + '" style="display:none"></div>' +
            '</div>';
        }).join("");
    }

    // --- Smooth progress ---
    var targetProgress = 0;
    var currentProgress = 0;
    var progressAnimFrame = null;

    function setTargetProgress(pct) {
        targetProgress = pct;
        if (!progressAnimFrame) animateProgress();
    }

    function animateProgress() {
        if (currentProgress < targetProgress) {
            currentProgress = Math.min(currentProgress + 0.5, targetProgress);
            document.getElementById("progressFill").style.width = currentProgress + "%";
            document.getElementById("progressPct").textContent = Math.round(currentProgress) + "%";
            progressAnimFrame = requestAnimationFrame(animateProgress);
        } else {
            progressAnimFrame = null;
        }
    }

    function updateProgress() {
        var done = document.querySelectorAll(".stage-check.done").length;
        var running = document.querySelectorAll(".stage-check.running").length;
        var pct = Math.round(done / STAGES.length * 100);
        setTargetProgress(pct);

        // Update current stage text
        var stageText = document.getElementById("progressStageText");
        if (done === STAGES.length) {
            stageText.textContent = "Finishing up...";
        } else {
            // Find the running stage
            for (var i = 0; i < STAGES.length; i++) {
                var ind = document.getElementById('ind-' + (i+1));
                if (ind && ind.classList.contains('running')) {
                    stageText.textContent = (STAGE_LABELS[STAGES[i]] || STAGES[i]) + '...';
                    break;
                }
            }
        }
    }

    async function startTailoring() {
        if (!serviceConfigured) { showError("Service is not configured. An admin must set the API key at /admin."); return; }
        var file = fileInput.files[0], jd = jdTA.value.trim();
        var mode = document.querySelector('input[name="mode"]:checked').value;
        var template = document.querySelector('input[name="template"]:checked').value;
        var model = getSelectedModel();

        if (!file) { showError("Please upload your resume first."); return; }
        if (!jd || jd.length < 50) {
            jdTA.classList.add('input-error');
            document.getElementById('jdError').classList.add('visible');
            showError("Job description is too short (minimum 50 characters).");
            jdTA.focus();
            return;
        }

        // Reset progress state
        targetProgress = 0;
        currentProgress = 0;
        if (progressAnimFrame) { cancelAnimationFrame(progressAnimFrame); progressAnimFrame = null; }

        var btn = document.getElementById("btnRun");
        btn.disabled = true;
        btn.textContent = "Processing...";
        document.getElementById("progressSection").classList.add("active");
        document.getElementById("resultsSection").classList.remove("active");
        document.getElementById("progressStageText").textContent = "Analyzing your resume...";
        renderStages();
        document.getElementById("progressFill").style.width = "0%";
        document.getElementById("progressPct").textContent = "0%";
        startTipRotation();

        var fd = new FormData();
        fd.append("resume", file);
        fd.append("job_description", jd);
        fd.append("mode", mode);
        fd.append("template", template);
        if (model) fd.append("model", model);

        try {
            var r = await fetch("/api/tailor", {method: "POST", body: fd});
            var d = await r.json();
            if (!r.ok) {
                showError(d.error || "Failed to start");
                btn.disabled = false; btn.textContent = "Tailor My Resume";
                stopTipRotation();
                return;
            }
            var jobId = d.job_id;

            function connectSSE() {
                var es = new EventSource('/api/progress/' + jobId);
                es.onmessage = function(ev) {
                    var m = JSON.parse(ev.data);
                    if (m.status === "complete") {
                        es.close();
                        stopTipRotation();
                        loadResults(jobId);
                        btn.disabled = false; btn.textContent = "Tailor My Resume";
                        return;
                    }
                    if (m.status === "error") {
                        es.close();
                        stopTipRotation();
                        showError("Pipeline error: " + (m.detail || "Unknown"));
                        btn.disabled = false; btn.textContent = "Tailor My Resume";
                        return;
                    }
                    if (m.status === "keepalive") return;
                    if (m.stage) {
                        var ind = document.getElementById('ind-' + m.stage);
                        var det = document.getElementById('det-' + m.stage);
                        var row = document.getElementById('stage-row-' + m.stage);
                        if (ind) {
                            ind.className = "stage-check " + m.status;
                            if (m.status === "done") {
                                ind.innerHTML = '<svg width="18" height="18" viewBox="0 0 18 18" fill="none"><circle cx="9" cy="9" r="8" fill="currentColor" opacity="0.15"/><path d="M6 9.5l2 2 4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>';
                            } else if (m.status === "running") {
                                ind.innerHTML = '<svg width="18" height="18" viewBox="0 0 18 18" fill="none"><circle cx="9" cy="9" r="7" stroke="currentColor" stroke-width="2" fill="none" stroke-dasharray="10 5"><animateTransform attributeName="transform" type="rotate" from="0 9 9" to="360 9 9" dur="1s" repeatCount="indefinite"/></circle></svg>';
                            } else if (m.status === "error") {
                                ind.innerHTML = '<svg width="18" height="18" viewBox="0 0 18 18" fill="none"><circle cx="9" cy="9" r="8" fill="currentColor" opacity="0.15"/><path d="M6.5 6.5l5 5M11.5 6.5l-5 5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>';
                            }
                        }
                        if (row) {
                            row.className = 'stage';
                            if (m.status === 'done') row.classList.add('is-done');
                            else if (m.status === 'running') row.classList.add('is-running');
                        }
                        if (det) det.textContent = m.detail || "";
                        updateProgress();
                    }
                };
                es.onerror = function() { es.close(); pollForResult(jobId); };
            }

            function pollForResult(jid) {
                var poll = setInterval(async function() {
                    try {
                        var r = await fetch('/api/result/' + jid);
                        var d = await r.json();
                        if (d.status === "complete") {
                            clearInterval(poll);
                            stopTipRotation();
                            loadResults(jid);
                            btn.disabled = false; btn.textContent = "Tailor My Resume";
                        } else if (d.status === "error") {
                            clearInterval(poll);
                            stopTipRotation();
                            showError("Pipeline error: " + (d.error || "Unknown"));
                            btn.disabled = false; btn.textContent = "Tailor My Resume";
                        }
                    } catch(e) {}
                }, 5000);
            }

            connectSSE();
        } catch(e) {
            showError("Network error: " + e.message);
            btn.disabled = false; btn.textContent = "Tailor My Resume";
            stopTipRotation();
        }
    }

    async function loadResults(jobId) {
        var r = await fetch('/api/result/' + jobId);
        var d = await r.json();
        if (d.status !== "complete") return;
        var s = d.result;

        // --- Circular Score ---
        var scoreVal = s.match_score.toFixed(0);
        var scoreNum = parseFloat(scoreVal);
        document.getElementById("matchScore").textContent = scoreVal + "%";

        // Animate the ring
        var circumference = 2 * Math.PI * 60; // r=60
        var offset = circumference - (scoreNum / 100) * circumference;
        var ring = document.getElementById("scoreRing");
        ring.style.strokeDasharray = circumference;
        // Determine color
        var scoreColor = scoreNum >= 80 ? 'var(--score-high)' : scoreNum >= 50 ? 'var(--score-mid)' : 'var(--score-low)';
        ring.style.stroke = scoreColor;
        // Trigger animation after a short delay
        setTimeout(function() {
            ring.style.strokeDashoffset = offset;
        }, 100);

        // Keyword Match
        var kwMatchPct = Math.round(s.cosine_similarity * 100);
        document.getElementById("keywordMatch").textContent = kwMatchPct + "%";

        // Keywords Added
        var totalKeywords = (s.missing_keywords ? s.missing_keywords.length : 0);
        var keywordsAddedCount;
        if (typeof s.matched_keywords_count === 'number') {
            keywordsAddedCount = s.matched_keywords_count;
        } else {
            keywordsAddedCount = Math.max(1, Math.round(s.match_score * 0.3));
        }
        document.getElementById("keywordsAdded").textContent = keywordsAddedCount;

        // Keywords chips
        if (s.missing_keywords && s.missing_keywords.length > 0) {
            document.getElementById("kwSection").style.display = "block";
            document.getElementById("kwList").innerHTML = s.missing_keywords.map(function(k) {
                return '<span class="kw kw-missing">' + escapeHtml(k) + '</span>';
            }).join("");
        }

        // --- Downloads ---
        var atsLink = '';
        var recLink = '';
        var secondaryHtml = '';

        s.files.forEach(function(f) {
            var m = FILES[f] || {l: f, b: "", cat: "other", primary: false};
            var link = '/api/download/' + jobId + '/' + f;
            if (m.primary) {
                if (m.cat === 'ats') atsLink = link;
                else if (m.cat === 'rec') recLink = link;
            } else {
                secondaryHtml += '<a class="dl-btn-secondary" href="' + link + '">' +
                    '<span class="label">' + escapeHtml(m.l) + '</span>' +
                    '<span class="badge">' + m.b + '</span></a>';
            }
        });

        // Wire up download cards
        var atsCard = document.getElementById("dlCardAts");
        var recCard = document.getElementById("dlCardRec");
        if (atsLink) {
            atsCard.href = atsLink;
            atsCard.setAttribute('href', atsLink);
            // Make it a link
            var atsParent = atsCard.parentNode;
            var atsA = document.createElement('a');
            atsA.className = atsCard.className;
            atsA.href = atsLink;
            atsA.innerHTML = atsCard.innerHTML;
            atsParent.replaceChild(atsA, atsCard);
        }
        if (recLink) {
            var recParent = recCard.parentNode;
            var recA = document.createElement('a');
            recA.className = recCard.className;
            recA.href = recLink;
            recA.innerHTML = recCard.innerHTML;
            recParent.replaceChild(recA, recCard);
        }

        document.getElementById("dlGridSecondary").innerHTML = secondaryHtml;

        // --- Talking Points ---
        if (s.talking_points_md) {
            document.getElementById("talkingPointsCard").style.display = "block";
            document.getElementById("talkingPointsContent").innerHTML = renderMarkdown(s.talking_points_md);
        } else {
            document.getElementById("talkingPointsCard").style.display = "none";
        }

        // --- Preview tabs ---
        var previews = [
            {id: "ats", l: "ATS Resume", c: s.ats_resume_md},
            {id: "rec", l: "Recruiter Resume", c: s.recruiter_resume_md}
        ];
        document.getElementById("tabs").innerHTML = previews.map(function(p, i) {
            return '<button class="tab ' + (i === 0 ? 'active' : '') + '" onclick="switchTab(\'' + p.id + '\',this)">' + p.l + '</button>';
        }).join("");
        document.getElementById("panels").innerHTML = previews.map(function(p, i) {
            return '<div class="tab-content ' + (i === 0 ? 'active' : '') + '" id="pnl-' + p.id + '">' + renderMarkdown(p.c) + '</div>';
        }).join("");

        document.getElementById("resultsSection").classList.add("active");
        document.getElementById("resultsSection").scrollIntoView({behavior: "smooth"});
    }

    function switchTab(id, el) {
        document.querySelectorAll(".tab").forEach(function(t) { t.classList.remove("active"); });
        document.querySelectorAll(".tab-content").forEach(function(p) { p.classList.remove("active"); });
        el.classList.add("active");
        document.getElementById('pnl-' + id).classList.add("active");
    }

    function copyPreview() {
        var p = document.querySelector(".tab-content.active");
        if (!p) return;
        navigator.clipboard.writeText(p.textContent).then(function() {
            var b = document.querySelector(".copy-btn");
            b.textContent = "Copied!";
            setTimeout(function() { b.textContent = "Copy"; }, 2000);
        });
    }

    function toggleAdditional() {
        var btn = document.getElementById("additionalToggle");
        var files = document.getElementById("additionalFiles");
        btn.classList.toggle("open");
        files.classList.toggle("open");
    }

    function resetForm() {
        fileInput.value = "";
        jdTA.value = "";
        uploadZone.classList.remove("has-file");
        fileNameEl.style.display = "none";
        document.getElementById("resultsSection").classList.remove("active");
        document.getElementById("progressSection").classList.remove("active");
        document.getElementById("charCount").textContent = "0";
        document.getElementById("wordCount").textContent = "0";
        jdTA.classList.remove('input-error');
        document.getElementById('jdError').classList.remove('visible');
        dismissError();
        stopTipRotation();
        targetProgress = 0;
        currentProgress = 0;

        // Reset score ring
        var ring = document.getElementById("scoreRing");
        if (ring) {
            ring.style.strokeDashoffset = 376.99;
        }

        // Reset download cards to divs (in case they became <a> tags)
        var dlCards = document.getElementById("dlCards");
        if (dlCards) {
            dlCards.innerHTML =
                '<div class="dl-card" id="dlCardAts">' +
                    '<div class="dl-card-icon ats"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg></div>' +
                    '<div class="dl-card-title">ATS Resume</div>' +
                    '<div class="dl-card-desc">Optimized for automated screening systems</div>' +
                    '<span class="dl-card-btn" id="dlBtnAts">Download PDF</span>' +
                '</div>' +
                '<div class="dl-card rec-card" id="dlCardRec">' +
                    '<div class="dl-card-icon rec"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="8.5" cy="7" r="4"/><line x1="20" y1="8" x2="20" y2="14"/><line x1="23" y1="11" x2="17" y2="11"/></svg></div>' +
                    '<div class="dl-card-title">Recruiter Resume</div>' +
                    '<div class="dl-card-desc">Enhanced for human readability</div>' +
                    '<span class="dl-card-btn" id="dlBtnRec">Download PDF</span>' +
                '</div>';
        }

        // Close additional files
        document.getElementById("additionalToggle").classList.remove("open");
        document.getElementById("additionalFiles").classList.remove("open");

        var btn = document.getElementById("btnRun");
        btn.disabled = false;
        btn.textContent = "Tailor My Resume";
        document.querySelector(".site-header").scrollIntoView({behavior: "smooth"});
    }
    </script>
</body>
</html>
