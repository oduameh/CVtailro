<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CVtailro</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%232563eb' width='100' height='100' rx='20'/><text x='50' y='68' font-size='60' font-weight='bold' text-anchor='middle' fill='white' font-family='system-ui'>CV</text></svg>">
    <style>
        :root {
            --bg: #f8fafc;
            --card: #ffffff;
            --border: #e2e8f0;
            --text: #0f172a;
            --text-secondary: #64748b;
            --accent: #2563eb;
            --accent-hover: #1d4ed8;
            --accent-light: #eff6ff;
            --success: #16a34a;
            --error: #dc2626;
            --radius: 12px;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }
        .container { max-width: 920px; margin: 0 auto; padding: 0 24px 60px; }

        /* ─── Header ─── */
        header {
            text-align: center;
            padding: 52px 24px 44px;
            background: linear-gradient(135deg, #eff6ff 0%, #f0f4ff 50%, #f5f7ff 100%);
            border-bottom: 1px solid rgba(37,99,235,0.08);
            margin-bottom: 40px;
        }
        header h1 {
            font-size: 38px; font-weight: 800; letter-spacing: -1px;
            background: linear-gradient(135deg, #2563eb, #1e40af);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        header p { color: var(--text-secondary); font-size: 16px; margin-top: 8px; font-weight: 500; }

        /* ─── Cards ─── */
        .card {
            background: var(--card); border: 1px solid var(--border);
            border-radius: var(--radius); padding: 28px; margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.04);
        }
        .card h2 {
            font-size: 15px; font-weight: 700; color: var(--text);
            margin-bottom: 20px; border-left: 4px solid var(--accent); padding-left: 12px;
        }

        /* ─── Upload ─── */
        .upload-zone {
            border: 2px dashed #cbd5e1; border-radius: var(--radius);
            padding: 48px 36px; text-align: center; cursor: pointer;
            transition: all 0.3s; position: relative;
            background: linear-gradient(135deg, #f8fafc, #f1f5f9);
        }
        .upload-zone:hover { border-color: var(--accent); background: var(--accent-light); transform: translateY(-2px); box-shadow: 0 4px 12px rgba(37,99,235,0.08); }
        .upload-zone.dragover { border-color: var(--accent); background: var(--accent-light); box-shadow: 0 8px 20px rgba(37,99,235,0.12); transform: translateY(-3px); }
        .upload-zone.has-file { border-color: var(--success); background: #f0fdf4; }
        .upload-zone input[type="file"] { position: absolute; inset: 0; opacity: 0; cursor: pointer; }
        .upload-icon { font-size: 40px; margin-bottom: 10px; }
        .upload-label { font-size: 15px; color: var(--text-secondary); }
        .upload-label strong { color: var(--accent); }
        .file-name { font-size: 14px; font-weight: 600; color: var(--success); margin-top: 10px; }

        /* ─── Textarea ─── */
        textarea {
            width: 100%; min-height: 200px; border: 1px solid var(--border);
            border-radius: 8px; padding: 14px; font-family: inherit;
            font-size: 14px; line-height: 1.6; resize: vertical; outline: none;
            transition: border-color 0.2s;
        }
        textarea:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(37,99,235,0.1); }
        textarea::placeholder { color: #94a3b8; }
        .char-count { margin-top: 8px; font-size: 12px; color: var(--text-secondary); }

        /* ─── Controls ─── */
        .controls { display: flex; align-items: center; gap: 12px; margin-bottom: 20px; flex-wrap: wrap; }
        .toggle-group {
            display: flex; border: 1px solid var(--border); border-radius: 8px; overflow: hidden;
        }
        .toggle-group label {
            padding: 10px 18px; font-size: 13px; font-weight: 500;
            cursor: pointer; transition: all 0.2s; user-select: none; white-space: nowrap;
        }
        .toggle-group input { display: none; }
        .toggle-group input:checked + label { background: var(--accent); color: white; }
        .toggle-group label:hover { background: var(--accent-light); }
        .toggle-group input:checked + label:hover { background: var(--accent-hover); }
        .btn-run {
            flex: 1; min-width: 200px; padding: 12px 24px; background: var(--accent); color: white;
            border: none; border-radius: 8px; font-size: 15px; font-weight: 600;
            cursor: pointer; transition: all 0.2s; box-shadow: 0 2px 8px rgba(37,99,235,0.2);
        }
        .btn-run:hover:not(:disabled) { background: var(--accent-hover); box-shadow: 0 4px 16px rgba(37,99,235,0.3); transform: translateY(-1px); }
        .btn-run:disabled { opacity: 0.5; cursor: not-allowed; transform: none; box-shadow: none; }

        /* ─── Progress ─── */
        .progress-section { display: none; }
        .progress-section.active { display: block; }
        .progress-bar-wrap { margin-bottom: 24px; }
        .progress-bar-header { display: flex; justify-content: space-between; margin-bottom: 8px; }
        .progress-bar-header span { font-size: 13px; font-weight: 600; color: var(--text-secondary); }
        .progress-bar-header .pct { color: var(--accent); }
        .progress-bar-track { width: 100%; height: 6px; background: #e2e8f0; border-radius: 3px; overflow: hidden; }
        .progress-bar-fill { width: 0%; height: 100%; background: linear-gradient(90deg, var(--accent), var(--accent-hover)); transition: width 0.4s ease; border-radius: 3px; }
        .stage { display: flex; align-items: flex-start; gap: 14px; padding: 11px 0; border-bottom: 1px solid #f1f5f9; }
        .stage:last-child { border-bottom: none; }
        .stage-ind {
            width: 30px; height: 30px; border-radius: 50%; display: flex;
            align-items: center; justify-content: center; font-size: 12px;
            font-weight: 700; flex-shrink: 0; margin-top: 1px; transition: all 0.3s;
        }
        .stage-ind.pending { background: #f1f5f9; color: #94a3b8; }
        .stage-ind.running { background: #dbeafe; color: var(--accent); animation: pulse 1.5s infinite; }
        .stage-ind.done { background: #dcfce7; color: var(--success); font-weight: 900; }
        .stage-ind.error { background: #fee2e2; color: var(--error); }
        @keyframes pulse { 0%,100% { opacity:1; } 50% { opacity:0.4; } }
        .stage-info { flex: 1; }
        .stage-name { font-size: 14px; font-weight: 600; }
        .stage-detail { font-size: 13px; color: var(--text-secondary); margin-top: 2px; }

        /* ─── Results ─── */
        .results-section { display: none; }
        .results-section.active { display: block; }
        .score-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 14px; margin-bottom: 24px; }
        .score-card {
            text-align: center; padding: 24px 16px;
            background: linear-gradient(135deg, #f8fafc, #f1f5f9);
            border-radius: 10px; border: 1px solid var(--border); transition: all 0.2s;
        }
        .score-card:hover { border-color: var(--accent); box-shadow: 0 4px 12px rgba(37,99,235,0.08); transform: translateY(-2px); }
        .score-value {
            font-size: 36px; font-weight: 800;
            background: linear-gradient(135deg, var(--accent), var(--accent-hover));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
        }
        .score-label { font-size: 11px; text-transform: uppercase; letter-spacing: 0.6px; color: var(--text-secondary); margin-top: 6px; font-weight: 600; }

        .download-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .dl-btn {
            display: flex; align-items: center; gap: 10px; padding: 14px 16px;
            background: var(--accent); border: none; border-radius: 8px;
            text-decoration: none; color: white; font-size: 13px; font-weight: 600;
            transition: all 0.2s; box-shadow: 0 2px 6px rgba(37,99,235,0.15);
        }
        .dl-btn:hover { background: var(--accent-hover); box-shadow: 0 4px 12px rgba(37,99,235,0.25); transform: translateY(-1px); }
        .dl-btn .icon { font-size: 18px; }
        .dl-btn .label { flex: 1; }
        .dl-btn .badge { font-size: 10px; text-transform: uppercase; letter-spacing: 0.5px; padding: 3px 8px; border-radius: 4px; font-weight: 700; background: rgba(255,255,255,0.2); }

        .keywords { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 10px; }
        .kw {
            font-size: 12px; padding: 5px 11px; background: linear-gradient(135deg,#fef3c7,#fde68a);
            color: #7c2d12; border-radius: 5px; font-weight: 600; border: 1px solid #fcd34d;
        }

        /* ─── Tabs ─── */
        .tab-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .tabs { display: flex; border-bottom: 2px solid var(--border); }
        .tab {
            padding: 10px 18px; font-size: 13px; font-weight: 600; cursor: pointer;
            border-bottom: 2px solid transparent; margin-bottom: -2px;
            color: var(--text-secondary); transition: all 0.2s; background: none;
            border-top: none; border-left: none; border-right: none;
        }
        .tab:hover { color: var(--text); }
        .tab.active { color: var(--accent); border-bottom-color: var(--accent); }
        .tab-content {
            display: none; max-height: 500px; overflow-y: auto; padding: 16px;
            background: #f8fafc; border-radius: 8px; font-size: 13px;
            line-height: 1.7; white-space: pre-wrap; font-family: "SF Mono","Fira Code",monospace;
        }
        .tab-content.active { display: block; }
        .copy-btn {
            padding: 7px 14px; background: var(--accent); color: white; border: none;
            border-radius: 6px; font-size: 12px; font-weight: 600; cursor: pointer; transition: all 0.2s;
        }
        .copy-btn:hover { background: var(--accent-hover); }

        /* ─── Error ─── */
        .error-banner { display: none; padding: 14px 18px; background: #fee2e2; color: var(--error); border-radius: 8px; font-size: 14px; margin-bottom: 20px; }
        .error-banner.active { display: block; }

        /* ─── Try Again ─── */
        .again-wrap { text-align: center; margin-top: 32px; }
        .btn-again {
            padding: 12px 28px; background: var(--accent); color: white; border: none;
            border-radius: 8px; font-size: 15px; font-weight: 600; cursor: pointer;
            transition: all 0.2s; box-shadow: 0 2px 8px rgba(37,99,235,0.15);
        }
        .btn-again:hover { background: var(--accent-hover); box-shadow: 0 4px 12px rgba(37,99,235,0.25); }

        footer { text-align: center; color: #94a3b8; font-size: 12px; margin-top: 48px; padding-bottom: 32px; }

        /* ─── Mobile ─── */
        @media (max-width: 768px) {
            header { padding: 36px 16px; }
            header h1 { font-size: 28px; }
            .container { padding: 0 16px 40px; }
            .score-grid { grid-template-columns: 1fr; }
            .download-grid { grid-template-columns: 1fr; }
            .controls { flex-direction: column; }
            .btn-run { width: 100%; }
        }
    </style>
</head>
<body>
    <header>
        <h1>CVtailro</h1>
        <p>AI-powered resume tailoring &mdash; upload, paste, optimise</p>
    </header>

    <div class="container">
        <div class="error-banner" id="errorBanner"></div>

        <!-- Status Banner (shown when service not configured) -->
        <div id="configBanner" style="display:none; padding: 14px 18px; background: #fef3c7; color: #92400e;
             border: 1px solid #fcd34d; border-radius: 8px; font-size: 14px; margin-bottom: 20px;">
            Service is not configured. An admin needs to set the API key in the
            <a href="/admin" style="color: #92400e; font-weight: 600;">Admin Panel</a>.
        </div>

        <!-- Model Selection (hidden if admin disables user model selection) -->
        <div class="card" id="settingsCard">
            <h2>Model</h2>
            <div style="display: flex; gap: 12px; flex-wrap: wrap; align-items: flex-end;">
                <div style="flex: 1; min-width: 180px;">
                    <label for="modelSelect" style="font-size: 13px; font-weight: 600; color: var(--text-secondary); display: block; margin-bottom: 6px;">
                        AI Model
                    </label>
                    <select id="modelSelect" onchange="saveModelPref()"
                        style="width: 100%; padding: 10px 14px; border: 1px solid var(--border);
                               border-radius: 8px; font-size: 13px; outline: none; background: white;
                               cursor: pointer; transition: border-color 0.2s;">
                    </select>
                </div>
            </div>
        </div>

        <!-- Upload -->
        <div class="card">
            <h2>Upload Your Resume</h2>
            <div class="upload-zone" id="uploadZone">
                <input type="file" id="resumeFile" accept=".pdf,.md,.txt">
                <div class="upload-icon">&#128196;</div>
                <div class="upload-label"><strong>Click to upload</strong> or drag and drop<br>PDF, Markdown, or plain text</div>
                <div class="file-name" id="fileName" style="display:none"></div>
            </div>
        </div>

        <!-- Job Description -->
        <div class="card">
            <h2>Paste the Job Description</h2>
            <textarea id="jobDescription" placeholder="Paste the full job description here..."></textarea>
            <div class="char-count"><span id="charCount">0</span> characters &middot; <span id="wordCount">0</span> words</div>
        </div>

        <!-- Controls -->
        <div class="controls">
            <div class="toggle-group">
                <input type="radio" name="mode" id="modeC" value="conservative" checked>
                <label for="modeC">Conservative</label>
                <input type="radio" name="mode" id="modeA" value="aggressive">
                <label for="modeA">Aggressive</label>
            </div>
            <div class="toggle-group">
                <input type="radio" name="template" id="tplExec" value="executive">
                <label for="tplExec">Executive</label>
                <input type="radio" name="template" id="tplModern" value="modern" checked>
                <label for="tplModern">Modern</label>
                <input type="radio" name="template" id="tplMin" value="minimal">
                <label for="tplMin">Minimal</label>
            </div>
            <button class="btn-run" id="btnRun" onclick="startTailoring()">Tailor My Resume</button>
        </div>

        <!-- Progress -->
        <div class="card progress-section" id="progressSection">
            <h2>Pipeline Progress</h2>
            <div class="progress-bar-wrap">
                <div class="progress-bar-header">
                    <span>OVERALL PROGRESS</span>
                    <span class="pct" id="progressPct">0%</span>
                </div>
                <div class="progress-bar-track"><div class="progress-bar-fill" id="progressFill"></div></div>
            </div>
            <div id="stageList"></div>
        </div>

        <!-- Results -->
        <div class="results-section" id="resultsSection">
            <div class="card">
                <h2>Match Results</h2>
                <div class="score-grid">
                    <div class="score-card"><div class="score-value" id="matchScore">--</div><div class="score-label">Match Score</div></div>
                    <div class="score-card"><div class="score-value" id="cosineSim">--</div><div class="score-label">Cosine Similarity</div></div>
                    <div class="score-card"><div class="score-value" id="missingCount">--</div><div class="score-label">Missing Keywords</div></div>
                </div>
                <div id="kwSection" style="display:none">
                    <strong style="font-size:12px;color:var(--text-secondary);text-transform:uppercase;letter-spacing:0.5px">Missing Keywords</strong>
                    <div class="keywords" id="kwList"></div>
                </div>
            </div>

            <div class="card">
                <h2>Download Tailored Resumes</h2>
                <div class="download-grid" id="dlGrid"></div>
            </div>

            <div class="card">
                <div class="tab-header">
                    <h2 style="margin-bottom:0">Preview</h2>
                    <button class="copy-btn" onclick="copyPreview()">&#128203; Copy</button>
                </div>
                <div class="tabs" id="tabs"></div>
                <div id="panels"></div>
            </div>

            <div class="again-wrap">
                <button class="btn-again" onclick="resetForm()">&#8635; Tailor Another Resume</button>
            </div>
        </div>

        <footer>CVtailro &mdash; 2026</footer>
    </div>

    <script>
    const STAGES = ["Job Intelligence","Resume Parser","Gap Analysis","Bullet Optimiser","ATS Optimiser","Recruiter Optimiser","Final Assembly"];

    // ─── Settings Management ───
    let serviceConfigured = false;
    let userSelectable = true;

    async function loadSettings() {
        // Check service status first
        try {
            const statusResp = await fetch('/api/status');
            const statusData = await statusResp.json();
            serviceConfigured = statusData.configured;
            if (!serviceConfigured) {
                document.getElementById('configBanner').style.display = 'block';
                document.getElementById('btnRun').disabled = true;
            } else {
                document.getElementById('configBanner').style.display = 'none';
            }
        } catch(e) {
            document.getElementById('configBanner').style.display = 'block';
        }

        // Load models
        try {
            const modelsResp = await fetch('/api/models');
            const data = await modelsResp.json();
            userSelectable = data.user_selectable !== false;
            if (!userSelectable) {
                document.getElementById('settingsCard').style.display = 'none';
            } else {
                document.getElementById('settingsCard').style.display = 'block';
                const select = document.getElementById('modelSelect');
                const free = data.models.filter(m => m.name.includes('(Free)') || m.name.includes('(Auto)'));
                const paid = data.models.filter(m => !m.name.includes('(Free)') && !m.name.includes('(Auto)'));
                const savedModel = localStorage.getItem('cvtailro_model') || data.default;
                let html = '<optgroup label="Free (no credits needed)">';
                free.forEach(m => { html += '<option value="' + m.id + '"' + (m.id === savedModel ? ' selected' : '') + '>' + m.name + '</option>'; });
                html += '</optgroup><optgroup label="Paid (requires credits)">';
                paid.forEach(m => { html += '<option value="' + m.id + '"' + (m.id === savedModel ? ' selected' : '') + '>' + m.name + '</option>'; });
                html += '</optgroup>';
                select.innerHTML = html;
            }
        } catch(e) {
            console.error('Failed to load models:', e);
        }
    }

    function saveModelPref() {
        localStorage.setItem('cvtailro_model', document.getElementById('modelSelect').value);
    }

    function getSelectedModel() {
        if (!userSelectable) return '';
        return document.getElementById('modelSelect').value;
    }

    loadSettings();
    const FILES = {
        "tailored_resume_ats.pdf":      {l:"ATS Resume",       i:"\u{1F4C4}",b:"PDF"},
        "tailored_resume_recruiter.pdf": {l:"Recruiter Resume", i:"\u{1F4C4}",b:"PDF"},
        "tailored_resume_ats.md":        {l:"ATS Resume",       i:"\u{1F4DD}",b:"MD"},
        "tailored_resume_recruiter.md":  {l:"Recruiter Resume", i:"\u{1F4DD}",b:"MD"},
        "match_report.json":             {l:"Match Report",     i:"\u{1F4CA}",b:"JSON"},
        "interview_talking_points.md":   {l:"Talking Points",   i:"\u{1F399}",b:"MD"},
    };

    // File upload
    const uploadZone=document.getElementById("uploadZone"),fileInput=document.getElementById("resumeFile"),fileNameEl=document.getElementById("fileName");
    fileInput.addEventListener("change",()=>{if(fileInput.files.length>0){uploadZone.classList.add("has-file");fileNameEl.textContent=fileInput.files[0].name;fileNameEl.style.display="block";}});
    uploadZone.addEventListener("dragover",e=>{e.preventDefault();uploadZone.classList.add("dragover");});
    uploadZone.addEventListener("dragleave",()=>uploadZone.classList.remove("dragover"));
    uploadZone.addEventListener("drop",e=>{e.preventDefault();uploadZone.classList.remove("dragover");if(e.dataTransfer.files.length>0){fileInput.files=e.dataTransfer.files;fileInput.dispatchEvent(new Event("change"));}});

    // Char count
    const jdTA=document.getElementById("jobDescription");
    jdTA.addEventListener("input",()=>{
        document.getElementById("charCount").textContent=jdTA.value.length;
        document.getElementById("wordCount").textContent=jdTA.value.split(/\s+/).filter(w=>w).length;
    });

    // Keyboard shortcut
    document.addEventListener("keydown",e=>{if((e.ctrlKey||e.metaKey)&&e.key==="Enter"&&!document.getElementById("btnRun").disabled)startTailoring();});

    function showError(msg){const b=document.getElementById("errorBanner");b.textContent=msg;b.classList.add("active");setTimeout(()=>b.classList.remove("active"),8000);}

    function renderStages(){
        document.getElementById("stageList").innerHTML=STAGES.map((n,i)=>
            `<div class="stage"><div class="stage-ind pending" id="ind-${i+1}">${i+1}</div><div class="stage-info"><div class="stage-name">${n}</div><div class="stage-detail" id="det-${i+1}">Waiting...</div></div></div>`
        ).join("");
    }

    function updateProgress(){
        const done=document.querySelectorAll(".stage-ind.done").length;
        const pct=Math.round(done/STAGES.length*100);
        document.getElementById("progressFill").style.width=pct+"%";
        document.getElementById("progressPct").textContent=pct+"%";
    }

    async function startTailoring(){
        if(!serviceConfigured){showError("Service is not configured. An admin must set the API key at /admin.");return;}
        const file=fileInput.files[0],jd=jdTA.value.trim();
        const mode=document.querySelector('input[name="mode"]:checked').value;
        const template=document.querySelector('input[name="template"]:checked').value;
        const model=getSelectedModel();
        if(!file){showError("Please upload your resume first.");return;}
        if(!jd||jd.length<50){showError("Job description is too short (minimum 50 characters).");return;}

        const btn=document.getElementById("btnRun");btn.disabled=true;btn.textContent="Processing...";
        document.getElementById("progressSection").classList.add("active");
        document.getElementById("resultsSection").classList.remove("active");
        renderStages();document.getElementById("progressFill").style.width="0%";document.getElementById("progressPct").textContent="0%";

        const fd=new FormData();fd.append("resume",file);fd.append("job_description",jd);fd.append("mode",mode);fd.append("template",template);if(model)fd.append("model",model);
        try{
            const r=await fetch("/api/tailor",{method:"POST",body:fd});const d=await r.json();
            if(!r.ok){showError(d.error||"Failed to start");btn.disabled=false;btn.textContent="Tailor My Resume";return;}
            const jobId=d.job_id,es=new EventSource(`/api/progress/${jobId}`);
            es.onmessage=ev=>{
                const m=JSON.parse(ev.data);
                if(m.status==="complete"){es.close();loadResults(jobId);btn.disabled=false;btn.textContent="Tailor My Resume";return;}
                if(m.status==="error"){es.close();showError("Pipeline error: "+(m.detail||"Unknown"));btn.disabled=false;btn.textContent="Tailor My Resume";return;}
                if(m.stage){const ind=document.getElementById(`ind-${m.stage}`),det=document.getElementById(`det-${m.stage}`);
                    if(ind){ind.className="stage-ind "+m.status;if(m.status==="done")ind.innerHTML="\u2713";}
                    if(det)det.textContent=m.detail||"";updateProgress();}
            };
            es.onerror=()=>{es.close();showError("Connection lost. Your job may still be running.");btn.disabled=false;btn.textContent="Tailor My Resume";};
        }catch(e){showError("Network error: "+e.message);btn.disabled=false;btn.textContent="Tailor My Resume";}
    }

    async function loadResults(jobId){
        const r=await fetch(`/api/result/${jobId}`);const d=await r.json();if(d.status!=="complete")return;const s=d.result;
        document.getElementById("matchScore").textContent=s.match_score.toFixed(0)+"%";
        document.getElementById("cosineSim").textContent=s.cosine_similarity.toFixed(2);
        document.getElementById("missingCount").textContent=s.missing_keywords.length;
        if(s.missing_keywords.length>0){document.getElementById("kwSection").style.display="block";
            document.getElementById("kwList").innerHTML=s.missing_keywords.map(k=>`<span class="kw">${k}</span>`).join("");}
        document.getElementById("dlGrid").innerHTML=s.files.map(f=>{const m=FILES[f]||{l:f,i:"\u{1F4C1}",b:""};
            return`<a class="dl-btn" href="/api/download/${jobId}/${f}"><span class="icon">${m.i}</span><span class="label">${m.l}</span><span class="badge">${m.b}</span></a>`;}).join("");
        const previews=[{id:"ats",l:"ATS Resume",c:s.ats_resume_md},{id:"rec",l:"Recruiter Resume",c:s.recruiter_resume_md},{id:"tp",l:"Talking Points",c:s.talking_points_md}];
        document.getElementById("tabs").innerHTML=previews.map((p,i)=>`<button class="tab ${i===0?"active":""}" onclick="switchTab('${p.id}',this)">${p.l}</button>`).join("");
        document.getElementById("panels").innerHTML=previews.map((p,i)=>`<div class="tab-content ${i===0?"active":""}" id="pnl-${p.id}">${esc(p.c)}</div>`).join("");
        document.getElementById("resultsSection").classList.add("active");
        document.getElementById("resultsSection").scrollIntoView({behavior:"smooth"});
    }

    function switchTab(id,el){document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));document.querySelectorAll(".tab-content").forEach(p=>p.classList.remove("active"));el.classList.add("active");document.getElementById(`pnl-${id}`).classList.add("active");}
    function esc(t){const d=document.createElement("div");d.textContent=t;return d.innerHTML;}

    function copyPreview(){
        const p=document.querySelector(".tab-content.active");if(!p)return;
        navigator.clipboard.writeText(p.textContent).then(()=>{
            const b=document.querySelector(".copy-btn");b.textContent="\u2713 Copied!";setTimeout(()=>b.textContent="\u{1F4CB} Copy",2000);
        });
    }

    function resetForm(){
        fileInput.value="";jdTA.value="";uploadZone.classList.remove("has-file");fileNameEl.style.display="none";
        document.getElementById("resultsSection").classList.remove("active");
        document.getElementById("progressSection").classList.remove("active");
        document.getElementById("charCount").textContent="0";document.getElementById("wordCount").textContent="0";
        const b=document.getElementById("btnRun");b.disabled=false;b.textContent="Tailor My Resume";
        document.querySelector("header").scrollIntoView({behavior:"smooth"});
    }
    </script>
</body>
</html>
